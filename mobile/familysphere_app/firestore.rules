rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users collection - users can read/write their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Families collection - family members can read/write
    match /families/{familyId} {
      allow read: if request.auth != null && 
                     request.auth.uid in resource.data.memberIds;
      allow write: if request.auth != null && 
                      request.auth.uid in resource.data.memberIds;
    }
    
    // Events collection - family members can read/write
    match /events/{eventId} {
      allow read, write: if request.auth != null;
    }
    
    // Tasks collection - family members can read/write
    match /tasks/{taskId} {
      allow read, write: if request.auth != null;
    }
    
    // Albums and Photos - family members can read/write
    match /albums/{albumId} {
      allow read, write: if request.auth != null;
    }
    
    match /photos/{photoId} {
      allow read, write: if request.auth != null;
    }
    
    // Expenses and Budgets - family members can read/write
    match /expenses/{expenseId} {
      allow read, write: if request.auth != null;
    }
    
    match /budgets/{budgetId} {
      allow read, write: if request.auth != null;
    }
    
    // Messages - family members can read/write
    match /messages/{messageId} {
      allow read, write: if request.auth != null;
    }
    
    // Health profiles - users can read/write their own and family members'
    match /health_profiles/{profileId} {
      allow read, write: if request.auth != null;
    }
    
    // Default: deny all other access
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
